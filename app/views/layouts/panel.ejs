<!doctype html>
<html lang="Fa-IR" dir="rtl">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title><%= title ?? 'داشبورد کاربر' %></title>
		<!-- bootstrap RTL css CDN -->
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css"
			integrity="sha384-dpuaG1suU0eT09tx5plTaGMLBsfDLzUCCUXOY2j/LSvXYuG6Bqs43ALlhIqAJVRb"
			crossorigin="anonymous"
		/>
		<!-- Vazir font CDN -->
		<link
			href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css"
			rel="stylesheet"
			type="text/css"
		/>
		<!-- sweet alert 2 -->
		<link
			href="
					https://cdn.jsdelivr.net/npm/sweetalert2@11.11.0/dist/sweetalert2.min.css
					"
			rel="stylesheet"
		/>
		<!-- icons -->
		<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
		<!-- global css file -->
		<link rel="stylesheet" href="/static/css/global.css" />
		<link rel="stylesheet" href="/static/css/panel.css">
		<%- style %>
	</head>
	<body style="background-color: #28293D;" class="text-white">
		<div class="container-fluid">
			<div class="row py-4"></div>
			<main class="row gx-5">
				<section class="col-lg-3 pt-5 ps-5">
					<div style="background-color: #28293D;"  class="offcanvas-lg offcanvas-end" tabindex="-1" id="offcanvasResponsive" aria-labelledby="offcanvasResponsiveLabel">
						<div class="offcanvas-header d-flex d-lg-none align-items-center">
							<button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#offcanvasResponsive" aria-label="Close"></button>
						</div>
						<div class="offcanvas-body d-block">
							<!-- body here ... -->
							<div class="d-flex flex-column text-center">
								<a class="fs-4 link-light" href="/">فروشگاه عطن</a>
								<ul id="nav" class="list-group list-group-flush mt-4">
									<li class="list-group-item border-0 fs-6 my-2 <%= urlPath == '/me' ? 'active' : ''%>"><a href="/me"><i class='bx bxs-home'></i><span class="ms-2">پیشخوان</span></a></li>
									<li class="list-group-item border-0 fs-6 my-2 <%= urlPath == '/me/courses' ? 'active' : ''%>"><a href="/me/courses"><i class='bx bxs-folder'></i><span class="ms-2">دوره ها</span></a></li>
									<li class="list-group-item border-0 fs-6 my-2 <%= urlPath == '/me/tickets' ? 'active' : ''%>"><a href="/me/tickets"><i class='bx bxs-chat'></i><span class="ms-2">تیکت ها</span></a></li>
									<li class="list-group-item border-0 fs-6 my-2 <%= urlPath == '/me/transactions' ? 'active' : ''%>"><a href="/me/transactions"><i class='bx bxs-dollar-circle'></i><span class="ms-2">تراکنش ها</span></a></li>
									<li class="list-group-item border-0 fs-6 my-2 <%= urlPath == '/me/edit' ? 'active' : ''%>"><a href="/me/edit"><i class='bx bxs-user'></i><span class="ms-2">جزئیات حساب</span></a></li>
									<li class="list-group-item border-0 fs-6 my-2"><a href="/logout"><i class='bx bx-log-out'></i><span class="ms-2">خروج</span></a></li>
								</ul>
							</div>
						</div>
					</div>
				</section>

				<section style="background-color: #1C1C28;" class="col-12 col-lg-8 rounded-4 p-5">
					<!-- top nav start -->
					<div class="row">
						<div class="d-flex align-items-center flex-wrap justify-content-center">
							<button class="btn btn-sm d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasResponsive" aria-controls="offcanvasResponsive">
								<i class='bx bx-menu fs-1 me-3' style='color:#fafafa'  ></i>
							</button>
							<h1 class="fs-4 me-lg-auto text-center text-lg-start my-3 my-lg-0"><%= user.name ?? 'کاربر'  %> عزیز خوش اومدی ! 👋🏻</h1>
							<div class="d-flex align-items-center justify-content-center mx-auto mx-lg-0 justify-content-lg-start">
							<!-- cart start-->
							<div class="btn-group order-last order-lg-first ms-3 ms-lg-0">
								<button class="position-relative me-lg-3 cart-button" data-bs-toggle="dropdown"  aria-expanded="false">
									<svg width="22" height="22" viewBox="0 0 22 22" fill="#454545" xmlns="http://www.w3.org/2000/svg">
										<path class="fill-current text-biscay-700 dark:text-gray-900 dark:group-hover:text-dark-920 group-hover:text-biscay-300" fill-rule="evenodd" clip-rule="evenodd" d="M19.1705 14.9551L18.4657 9.27669C18.0363 7.25046 16.8211 6.41663 15.6626 6.41663H6.35407C5.17937 6.41663 3.92365 7.1921 3.55909 9.27669L2.84616 14.9551C2.26286 19.1243 4.40973 20.1666 7.21282 20.1666H14.8119C17.6069 20.1666 19.689 18.6574 19.1705 14.9551ZM8.33901 11.1362C7.89158 11.1362 7.52887 10.7629 7.52887 10.3024C7.52887 9.84187 7.89158 9.46855 8.33901 9.46855C8.78644 9.46855 9.14915 9.84187 9.14915 10.3024C9.14915 10.7629 8.78644 11.1362 8.33901 11.1362ZM12.8353 10.3024C12.8353 10.7629 13.198 11.1362 13.6454 11.1362C14.0928 11.1362 14.4555 10.7629 14.4555 10.3024C14.4555 9.84187 14.0928 9.46855 13.6454 9.46855C13.198 9.46855 12.8353 9.84187 12.8353 10.3024Z"></path>
										<path class="fill-current text-biscay-700 dark:text-gray-900 dark:group-hover:text-dark-920 group-hover:text-biscay-300" opacity="0.4" d="M15.5594 6.20972C15.5623 6.28082 15.5486 6.35162 15.5195 6.41658H14.2021C14.1766 6.35053 14.1631 6.28049 14.1622 6.20972C14.1622 4.45201 12.7324 3.0271 10.9686 3.0271C9.20486 3.0271 7.77504 4.45201 7.77504 6.20972C7.78713 6.27815 7.78713 6.34815 7.77504 6.41658H6.42575C6.41367 6.34815 6.41367 6.27815 6.42575 6.20972C6.52827 3.76367 8.54793 1.83325 11.0046 1.83325C13.4612 1.83325 15.4808 3.76367 15.5834 6.20972H15.5594Z"></path>
								</svg>
								<!-- badge -->
								<% if (user.cartItems.length > 0) { %>
									<span class="position-absolute top-0 start-0 translate-middle badge rounded-pill bg-danger" >
										<%= user.cartItems.length %>
										<span class="visually-hidden">unread messages</span>
									</span>
								<% } %>
							</button>
							<ul class="dropdown-menu dropdown-center dropdown-menu-lg-end p-4" style="width: 450px;">
								<section>
									<div class="d-flex justify-content-between align-items-center">
										<p class="mb-0"><span class="me-2 itemsCount"><%= user.cartItems.length > 0  ? user.cartItems.length : 0  %></span><span>مورد</span></p>
										<a class="fw-bold btn btn-outline-primary" style="font-size: 14px;" href="/cart">مشاهده سبد خرید</a>
									</div>
									<hr class="w-75 mx-auto">
									<% if (user.cartItems.length > 0) { %>
									<div class="cart-prodcuts d-flex flex-column">
										<% user.cartItems.forEach(item => { %>
										<!-- cart product item start -->
										<div class="dropdown-item-text cart-product d-flex justify-content-evenly align-items-center border-bottom pb-2 mb-3 ">
											<a href="/courses/<%= item.slug %>" class="link link-dark">
												<img class="rounded" width="70px" src="<%= item?.thumbnail?.path ?? ''%>" alt="<%= item.title %>">
											</a>
											<div class="ms-3">
												<a class="link link-dark" href="/courses/<%= item.slug %>"><p class="mb-0 fw-bold" ><%= item.title %></p></a>
												<p class="mb-0 text-secondary mt-1 d-flex align-items-center">
													<span class="me-2 price number" data-value="<%= item.price %>"></span>
													<img width="16px" src="/static/imgs/toman-black.svg" alt="تومان" />
												</p>
											</div>
											<button data-courseId="<%= item._id %>" type="button" class="btn d-inline-flex justify-content-center align-items-center ms-auto ">
												<i class='bx bxs-trash-alt text-danger user-select-none removeCourseFromCartBtn'></i>
											</button>
										</div>
										<!-- cart product item start -->
										<% }) %>
										<div class="d-flex align-items-center">
											<p class="mb-0 fw-bold">جمع کل :</p>
											<p class="mb-0 number fw-bold ms-auto" data-value="<%= totalCost %>"></p>
										</div>
									</div>
									<% } else { %>
										<div class="emptyCartInfo">
											<p class="mb-0 text-secondary text-center">هنوز محصولی به سبد خرید اضافه نشده است</p>
											<a class="btn btn-outline-primary align-self-center mt-4 d-block" href="/courses">مشاهده دوره های آموزشی</a>
										</div>
									<% }  %>

								</section>
							</ul>
							</div>
							<!-- cart end-->
							<!-- user navigation button start -->
							<div class="dropdown dropcenter order-first">
								<section
									class="rounded-circle"
									data-bs-toggle="dropdown"
									aria-expanded="false"
								>
								<% if (user.photo) { %>
									<img
									class="avatar img-fluid rounded-circle"
									src="<%= user.photo %>"
									alt="avatar"
								/>
								<% } else {%>
									<img
									width="30px"
									height="30px"
									style="cursor: pointer;"
									class="img-fluid rounded-circle"
									src="/static/imgs/avatar.png"
									alt="avatar"
								/>
								<% }  %>
								</section>
								<ul class="dropdown-menu dropdown-menu-lg-end p-4">
									<div class="d-flex justify-content-around align-items-center">
										<a href="#">
											<% if (user.photo) { %>
												<img
												class="avatar img-fluid rounded-circle"
												src="<%= user.photo %>"
												alt="avatar"
											/>
											<% } else {%>
												<img
												width="30px"
												height="30px"
												style="cursor: pointer;"
												class="img-fluid rounded-circle"
												src="/static/imgs/avatar.png"
												alt="avatar"
											/>
											<% }  %>
										</a>
										<div>
											<a class="link-dark" href="/me"
												><p class="mb-0">
													<%= user.name ??
													user.email.slice(0,user.email.indexOf('@')) + '@' %>
												</p></a
											>
											<a class="icon-link icon-link-hover text-14" href="/me">
												مشاهده پنل کاربری
												<i class="bx bx-left-arrow-alt"></i>
											</a>
										</div>
									</div>
									<li><hr class="dropdown-divider" /></li>
									<li>
										<a
											class="dropdown-item d-inline-flex align-items-center"
											href="/me/courses"
											><i class="bx bx-video text-secondary"></i
											><span class="ms-2">دوره ها</span></a
										>
									</li>
									<li>
										<a
											class="dropdown-item d-inline-flex align-items-center"
											href="/logout"
											><i class="bx bx-log-out text-secondary"></i>
											<span class="ms-2">خروج از حساب کاربری</span></a
										>
									</li>
								</ul>
							</div>
							<!-- user navigation button end -->
							</div>
						</div>
					</div>
					<!-- top nav start -->
					<%- body %>
				</section>
				<div class="col-lg-1"></div>
			</main>
			<div class="row py-4"></div>
		</div>

	</body>
		<!-- popper -->
		<script
		src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
		integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
		crossorigin="anonymous"></script>
		<!-- bootstrap -->
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
			integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
			crossorigin="anonymous"></script>

		<!-- sweet alert 2  -->
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.11.0/dist/sweetalert2.all.min.js"></script>
		<!--  -->
		<%
				let sweetalert = alert;
				if(alert.length > 0) {
						let data = sweetalert[0];
		%>
					<script>
					const Toast = Swal.mixin({
						toast: true,
						position: 'top-end',
						showConfirmButton: false,
						timer: 3000,
						width : '10rem',
						timerProgressBar: true,
						didOpen: toast => {
							toast.onmouseenter = Swal.stopTimer;
							toast.onmouseleave = Swal.resumeTimer;
						},
					});
					Toast.fire({
						icon:'<%= data.icon %>',
						title: '<%= data.title %>',
					});
				</script>
		<% } %>

		<%- script %>
		<script src="/static/js/panel.js"></script>
</html>
